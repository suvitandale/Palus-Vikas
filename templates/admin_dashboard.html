<!-- templates/admin_dashboard.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>‡§Ö‚Äç‡•Ö‡§°‡§Æ‡§ø‡§® ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§° - ‡§™‡§≤‡•Ç‡§∏ ‡§µ‡§ø‡§ï‡§æ‡§∏</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="/static/css/styles.css">
  <style>
    .page-title { text-align:center; margin-bottom:30px; }
    .page-title h2 { margin:0; }
    .main-content { display:flex; gap:30px; margin:0 auto; max-width:1400px; }
    .filter-panel { flex:0 0 280px; background:#f9f9f9; padding:20px; border-radius:8px; height:fit-content; }
    .filter-panel h3 { margin-top:0; margin-bottom:20px; font-size:16px; }
    .filter-form { display:flex; flex-direction:column; gap:15px; }
    .filter-form select, .filter-form input { padding:10px; border:1px solid #ddd; border-radius:4px; font-size:14px; width:100%; box-sizing:border-box; }
    .filter-form button { padding:10px; background:#007bff; color:#fff; border:none; border-radius:4px; cursor:pointer; font-size:14px; }
    .filter-form button:hover { background:#0056b3; }
    .filter-form a { text-align:center; padding:10px; background:#6c757d; color:#fff; text-decoration:none; border-radius:4px; }
    .filter-form a:hover { background:#545b62; }
    .table-panel { flex:1; }
    table { width:100%; border-collapse:collapse; background:#fff; border-radius:6px; overflow:hidden; box-shadow:0 2px 4px rgba(0,0,0,0.1); border:2px solid #333; }
    table th, table td { padding:10px; border:1px solid #ddd; text-align:left; font-size:14px; }
    table th { background:#f5f5f5; font-weight:600; border:1px solid #999; }
    .small { font-size:14px; color:#333; }
    .ticket-id { font-weight:700; color:#333; font-size:14px; }
    .danger { background:#e85e5e; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; }
    .danger:hover { background:#d94242; }
    .btn-small { padding:6px 10px; border-radius:6px; border:none; cursor:pointer; }
    .export-btn { display:inline-block; margin-top:15px; padding:10px 20px; background:#28a745; color:#fff; text-decoration:none; border-radius:4px; }
    .export-btn:hover { background:#218838; }
    @media (max-width:768px) { 
      .main-content { flex-direction:column; gap:20px; }
      .filter-panel { flex:1; }
    }
  </style>
</head>
<body>

  <header class="simple-header">
    <div class="page-title"><h2>‡§Ö‚Äç‡•Ö‡§°‡§Æ‡§ø‡§® ‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§° - ‡§™‡§≤‡•Ç‡§∏ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Ø‡•ã‡§ú‡§®‡§æ</h2></div>
  </header>

  <main class="container">
    <div class="main-content">
      
      <!-- Left Panel: Filters -->
      <aside class="filter-panel">
        <h3>üìã ‡§´‡§ø‡§≤‡•ç‡§ü‡§∞ ‡§ï‡§∞‡§æ</h3>
        <form id="filterForm" method="get" action="/admin/dashboard" class="filter-form">

          <select name="category">
            <option value="" disabled selected>-- ‡§∏‡§∞‡•ç‡§µ ‡§∂‡•ç‡§∞‡•á‡§£‡•ç‡§Ø‡§æ --</option>
            {% for c in categories %}
              <option value="{{ c }}" {% if filter_category==c %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
          </select>

          <input type="text" name="prabhag" placeholder="‡§™‡•ç‡§∞‡§≠‡§æ‡§ó ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï" value="{{ filter_prabhag }}">

          <input type="text" name="search" placeholder="Search ticket/address/contact" value="{{ filter_search }}">

          <button type="submit">üîç Filter</button>
          <a href="/admin/dashboard">‚Ü∫ Reset</a>

        </form>
        
      </aside>

      <!-- Right Panel: Table -->
      <div class="table-panel">
        <table>
          <thead>
            <tr>
              <th>Ticket</th>
              <th>Category</th>
              <th>Subcategory</th>
              <th>Prabhag</th>
              <th>Contact</th>
              <th>Address</th>
              <th>Created At</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% if complaints %}
              {% for c in complaints %}
              <tr>
                <td class="ticket-id">{{ c['ticket_id'] }}</td>
                <td>{{ c['main_category'] }}</td>
                <td>{{ c['sub_category'] }}</td>
                <td>{{ c['prabhag'] }}</td>
                <td>{{ c['contact'] }}<br><span class="small">{{ c['email'] }}</span></td>
                <td style="max-width:240px;">{{ c['address'] }}</td>
                <td class="small">{% set date_part = c['created_at'][:10].split('-') %}{{ date_part[2] }}-{{ date_part[1] }}-{{ date_part[0] }} {{ c['created_at'][11:19] }}</td>
                <td>
                  <form method="post" action="/admin/delete/{{ c['id'] }}" onsubmit="return confirm('Are you sure you want to delete this complaint?');">
                    <button type="submit" class="danger">Delete</button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="8" style="text-align:center;">No complaints found.</td></tr>
            {% endif %}
          </tbody>
        </table>
        <a class="export-btn" href="/admin/export?category={{ filter_category }}&prabhag={{ filter_prabhag }}&search={{ filter_search }}">üì• Export CSV</a>
      </div>

    </div>
    
  </main>

  
  <footer class="footer">¬© ‡§™‡§≤‡•Ç‡§∏ ‡§µ‡§ø‡§ï‡§æ‡§∏ ‡§Ø‡•ã‡§ú‡§®‡§æ| <a href="/admin/login">‡§Ö‚Äç‡•Ö‡§°‡§Æ‡§ø‡§®</a></footer>

  <div class="navbar">
 <a href="/admin/logout" class="nav-link">‚Üê Logout</a>
  </div>



</body>
</html>


